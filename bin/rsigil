#!/bin/bash

SIGIL=$1
SRC=$2
TARGET=$3

TEMPFILE=/var/tmp/rsigil-$RANDOM

if [[ $SRC = *:* ]]; then
  SRCHOST=`echo $SRC | cut -d: -f1`
  SRCDIR=`echo $SRC | cut -d: -f2`
  SRCLEN=$((${#SRCDIR} + 2))
  ssh $SRCHOST "find $SRCDIR -name .$SIGIL -printf %h\\\\n" | cut -c$SRCLEN-
else
  cd $SRC
  find . -name .$SIGIL -printf %h\\n
fi > $TEMPFILE

rsync -vrt --files-from=$TEMPFILE --delete --exclude=.* $SRC $TARGET/
rm $TEMPFILE
