#!/bin/sh

filepath=$1
oldfile=$2
oldhash=$3
oldmode=$4
newfile=$5
newhash=$6
newmode=$7

dirname_path=`dirname $filepath`
mkdir -p $TMPDIR/{new,old}/$dirname_path

if [ "$oldfile" = /dev/null ]
then
  oldfilecp=/dev/null
else
  oldfilecp=$TMPDIR/old/$filepath
  cp -a $oldfile $oldfilecp
fi

if [ "${newfile:0:1}" = "/" ]
then
  newfilecp=$TMPDIR/new/$filepath
  echo "DO NOT EDIT. TEMPORARY FILE." > $newfilecp
  cat $newfile >> $newfilecp
  newfilepath=$newfilecp
else
  newfilepath=`pwd`/$newfile
fi

echo -n ": $oldfilecp $newfilepath " >> $TMPFILE
